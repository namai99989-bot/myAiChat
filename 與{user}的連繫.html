<html>
<head>
<style>
.sylavie-night-bond { --primary-red: #e60012; --deep-black: #0a0a0a; --dark-gray: #1a1a1a; --text-bright: #ffffff; --text-muted: #a0a0a0; --accent-gold: #d4af37; background-color: var(--deep-black); color: var(--text-bright); font-family: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif; padding: 1rem; line-height: 1.6; } .sylavie-night-bond .main-container { max-width: 600px; margin: 0 auto; background: linear-gradient(180deg, #121212 0%, #050505 100%); border: 1px solid #333; border-radius: 12px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.8); } .sylavie-night-bond .hero-banner { position: relative; width: 100%; height: 260px; overflow: hidden; } .sylavie-night-bond .hero-img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(20%) contrast(110%); } .sylavie-night-bond .hero-overlay { position: absolute; inset: 0; background: linear-gradient(to bottom, transparent 40%, var(--deep-black)); } .sylavie-night-bond .header-title { position: absolute; bottom: 20px; left: 20px; border-left: 4px solid var(--primary-red); padding-left: 12px; } .sylavie-night-bond .title-text { font-size: 1.75rem; font-weight: 800; letter-spacing: 2px; color: var(--text-bright); text-shadow: 2px 2px 4px rgba(0,0,0,0.9); } .sylavie-night-bond .story-nav { display: flex; flex-wrap: wrap; gap: 8px; padding: 15px; border-bottom: 1px solid #222; background: #0d0d0d; } .sylavie-night-bond .nav-trigger { display: none; } .sylavie-night-bond .nav-label { padding: 6px 12px; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; font-size: 0.85rem; cursor: pointer; transition: all 0.3s ease; color: var(--text-muted); } .sylavie-night-bond .nav-label:hover { border-color: var(--primary-red); color: var(--text-bright); } .sylavie-night-bond .content-section { display: none; padding: 20px; animation: fadeIn 0.5s ease forwards; } .sylavie-night-bond .card-image { width: 100%; border-radius: 8px; margin-bottom: 16px; border: 1px solid #444; box-shadow: 0 10px 20px rgba(0,0,0,0.5); } .sylavie-night-bond .section-title { font-size: 1.25rem; font-weight: bold; color: var(--primary-red); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; } .sylavie-night-bond .section-title::before { content: ''; width: 12px; height: 12px; background: var(--primary-red); border-radius: 2px; transform: rotate(45deg); } .sylavie-night-bond .story-body { text-align: left; color: #ececec; font-size: 0.95rem; background: rgba(255,255,255,0.03); padding: 15px; border-radius: 6px; border-left: 2px solid #333; } .sylavie-night-bond .trait-tag { display: inline-block; margin-top: 12px; padding: 4px 10px; background: rgba(230, 0, 18, 0.1); border: 1px solid rgba(230, 0, 18, 0.3); color: var(--primary-red); border-radius: 4px; font-size: 0.8rem; font-weight: bold; } #tab1:checked ~ .story-nav label[for="tab1"], #tab2:checked ~ .story-nav label[for="tab2"], #tab3:checked ~ .story-nav label[for="tab3"], #tab4:checked ~ .story-nav label[for="tab4"], #tab5:checked ~ .story-nav label[for="tab5"], #tab6:checked ~ .story-nav label[for="tab6"], #tab7:checked ~ .story-nav label[for="tab7"] { background: var(--primary-red); color: white; border-color: var(--primary-red); box-shadow: 0 0 10px rgba(230, 0, 18, 0.4); } #tab1:checked ~ #content1, #tab2:checked ~ #content2, #tab3:checked ~ #content3, #tab4:checked ~ #content4, #tab5:checked ~ #content5, #tab6:checked ~ #content6, #tab7:checked ~ #content7 { display: block; } @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } } .sylavie-night-bond .audio-wrapper { padding: 15px; background: #0d0d0d; border-top: 1px solid #222; } .sylavie-night-bond .cg-audio-controls { display: flex; align-items: center; justify-content: center; gap: 15px; } .sylavie-night-bond .cg-audio-controls__btn { background: none; border: 1px solid #444; color: var(--text-muted); width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; } .sylavie-night-bond .cg-audio-controls__btn:hover { border-color: var(--primary-red); color: var(--primary-red); }
</style>
<meta name="cg-name" content="ä»–èˆ‡{user}çš„é€£ç¹«" />
<meta name="cg-command-name" content="ä»–èˆ‡{user}çš„é€£ç¹«" />
<meta name="cg-color" content="#FF0505" />
<meta name="cg-icon" content="Spline" />
<meta name="cg-mode" content="release" />
</head>
<body>
<style>
.sylavie-night-bond {--primary-red: #e60012; --deep-black: #0a0a0a; --dark-gray: #1a1a1a; --text-bright: #fff; --text-muted: #a0a0a0; --accent-gold: #d4af37; background-color: var(--deep-black); color: var(--text-bright); font-family: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; padding: 1rem; line-height: 1.6;}
.sylavie-night-bond .main-container {max-width: 600px; margin: 0 auto; background: linear-gradient(180deg, #121212 0%, #050505 100%); border: 1px solid #333; border-radius: 12px; overflow: hidden; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);}
.sylavie-night-bond .hero-banner {position: relative; width: 100%; height: 260px; overflow: hidden;}
.sylavie-night-bond .hero-img {width: 100%; height: 100%; object-fit: cover; filter: grayscale(20%) contrast(110%);}
.sylavie-night-bond .hero-overlay {position: absolute; inset: 0; background: linear-gradient(to bottom, transparent 40%, var(--deep-black));}
.sylavie-night-bond .header-title {position: absolute; bottom: 20px; left: 20px; border-left: 4px solid var(--primary-red); padding-left: 12px;}
.sylavie-night-bond .title-text {font-size: 1.75rem; font-weight: 800; letter-spacing: 2px; color: var(--text-bright); text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.9);}
.sylavie-night-bond .story-nav {display: flex; flex-wrap: wrap; gap: 8px; padding: 15px; border-bottom: 1px solid #222; background: #0d0d0d;}
.sylavie-night-bond .nav-trigger {display: none;}
.sylavie-night-bond .nav-label {padding: 6px 12px; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; font-size: 0.85rem; cursor: pointer; transition: all 0.3s ease; color: var(--text-muted);}
.sylavie-night-bond .nav-label:hover {border-color: var(--primary-red); color: var(--text-bright);}
.sylavie-night-bond .content-section {display: none; padding: 20px; animation: fadeIn 0.5s ease forwards;}
.sylavie-night-bond .card-image {width: 100%; border-radius: 8px; margin-bottom: 16px; border: 1px solid #444; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);}
.sylavie-night-bond .section-title {font-size: 1.25rem; font-weight: bold; color: var(--primary-red); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;}
.sylavie-night-bond .section-title::before {content: ""; width: 12px; height: 12px; background: var(--primary-red); border-radius: 2px; transform: rotate(45deg);}
.sylavie-night-bond .story-body {text-align: left; color: #ececec; font-size: 0.95rem; background: rgba(255, 255, 255, 0.03); padding: 15px; border-radius: 6px; border-left: 2px solid #333;}
.sylavie-night-bond .trait-tag {display: inline-block; margin-top: 12px; padding: 4px 10px; background: rgba(230, 0, 18, 0.1); border: 1px solid rgba(230, 0, 18, 0.3); color: var(--primary-red); border-radius: 4px; font-size: 0.8rem; font-weight: bold;}
#tab1:checked ~ .story-nav label[for="tab1"], #tab2:checked ~ .story-nav label[for="tab2"], #tab3:checked ~ .story-nav label[for="tab3"], #tab4:checked ~ .story-nav label[for="tab4"], #tab5:checked ~ .story-nav label[for="tab5"], #tab6:checked ~ .story-nav label[for="tab6"], #tab7:checked ~ .story-nav label[for="tab7"] {background: var(--primary-red); color: white; border-color: var(--primary-red); box-shadow: 0 0 10px rgba(230, 0, 18, 0.4);}
#tab1:checked ~ #content1, #tab2:checked ~ #content2, #tab3:checked ~ #content3, #tab4:checked ~ #content4, #tab5:checked ~ #content5, #tab6:checked ~ #content6, #tab7:checked ~ #content7 {display: block;}
@keyframes fadeIn {
  from {opacity: 0; transform: translatey(10px);}
  to {opacity: 1; transform: translatey(0);}
}
.sylavie-night-bond .audio-wrapper {padding: 15px; background: #0d0d0d; border-top: 1px solid #222;}
.sylavie-night-bond .cg-audio-controls {display: flex; align-items: center; justify-content: center; gap: 15px;}
.sylavie-night-bond .cg-audio-controls__btn {background: none; border: 1px solid #444; color: var(--text-muted); width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s;}
.sylavie-night-bond .cg-audio-controls__btn:hover {border-color: var(--primary-red); color: var(--primary-red);}
</style>

<div class="sylavie-night-bond"><div class="main-container"><div class="hero-banner"><img src="https://i.postimg.cc/pTdHdPTv/from-Pix-AI-1960576063835689542.png" class="hero-img" alt="Cover"><div class="hero-overlay"></div><div class="header-title"><div class="title-text">ç§¦å¾¹èˆ‡{user}çš„é€£ç¹«ç›¸é—œçš„æ•…äº‹</div><div class="text-xs text-muted-foreground mt-1 opacity-70">N109 Zone / Dark Point / Deepspace Resonance</div></div></div><input type="radio" name="story-tabs" id="tab1" class="nav-trigger" checked=""><input type="radio" name="story-tabs" id="tab2" class="nav-trigger"><input type="radio" name="story-tabs" id="tab3" class="nav-trigger"><input type="radio" name="story-tabs" id="tab4" class="nav-trigger"><input type="radio" name="story-tabs" id="tab5" class="nav-trigger"><input type="radio" name="story-tabs" id="tab6" class="nav-trigger"><input type="radio" name="story-tabs" id="tab7" class="nav-trigger"><div class="story-nav"><label for="tab1" class="nav-label">ç¼å¤œä¹‹ç´„</label><label for="tab2" class="nav-label">æ·±ç©ºå…±é³´</label><label for="tab3" class="nav-label">æš—å¤œè¿½çµ</label><label for="tab4" class="nav-label">æ˜Ÿå¤œè´ˆç¦®</label><label for="tab5" class="nav-label">è¨“ç·´æ™‚åˆ»</label><label for="tab6" class="nav-label">å®¿èˆå¤œè«‡</label><label for="tab7" class="nav-label">çƒé´‰å‚³ä¿¡</label></div><div id="content1" class="content-section"><img src="https://i.postimg.cc/x1QBC9xW/from-Pix-AI-1960565791046897485.png" class="card-image"><div class="section-title">N109 åœ°ä¸‹æ‹³æ“Šå ´</div><div class="story-body">æ·±å¤œçš„æ‹³æ“Šå ´ç€°æ¼«è‘—æ±—æ°´èˆ‡è¡€è…¥æ°£ã€‚ç§¦å¾¹å‰›çµæŸä¸€å ´æƒ¡é¬¥ï¼Œå˜´è§’å¸¶è‘—åˆºçœ¼çš„ç´…ï¼Œçœ¼ç¥éŠ³åˆ©å¦‚åˆƒã€‚å‘¨åœçš„æŒ‘é‡è€…åœ¨ä»–ä¸€å€‹å†·å†½çš„æƒè¦–ä¸‹ç´›ç´›é€€æ•£ã€‚ç„¶è€Œï¼Œç•¶ä»–è½‰å‘å¸¶è‘—é†«ç™‚åŒ…çš„ {user} æ™‚ï¼Œé‚£è‚¡è‚…æ®ºä¹‹æ°£ç¬é–“æ¶ˆèã€‚ä»–é †å¾åœ°å½ä¸‹è…°ï¼Œä»»ç”±å¦³ç´°å¿ƒåœ°è™•ç†å‚·å£ï¼Œå”‡è§’å¾®å‹¾ï¼šã€Œå°ç‹¸èŠ±çš„æº«æŸ”â€¦â€¦æ¯”æš—é»çš„è—¥é‚„è¦æœ‰æ•ˆã€‚ã€</div><div class="trait-tag">#åå·®æº«æŸ” #çµ•å°å¼·è€…</div></div><div id="content2" class="content-section"><img src="https://i.postimg.cc/Z5mXRJ7s/from-Pix-AI-1960572302837697226.png" class="card-image"><div class="section-title">å®‰å…¨å±‹çš„å…±é³´</div><div class="story-body">Evol å¤±æ§å¸¶ä¾†çš„çœ©æšˆæ„Ÿè®“å¦³å¹¾ä¹ç«™ä¸ç©©ã€‚ç§¦å¾¹å°‡å¦³å¸¶å›äº†ä»–çš„ç§äººé ˜åœ°ã€‚é»‘è† å”±ç‰‡æ—‹è½‰è‘—ä½æ²‰çš„æ—‹å¾‹ï¼Œä»–ééä¸€æ¯æº«ç†±çš„é£²å“ï¼Œèªæ°£æ˜¯ä¸å®¹ç½®ç–‘çš„å …å®šï¼šã€Œæœ‰æˆ‘åœ¨ï¼Œä¸æœƒè®“ä½ æœ‰äº‹ã€‚ã€ä»–å°‡çè²´çš„å¯¶çŸ³å¡é€²å¦³æ‰‹ä¸­ï¼Œå½·å½¿é‚£åªæ˜¯éš¨æ‰‹å¯å¾—çš„å°ç©æ„ï¼Œã€Œå–œæ­¡å°±æ‹¿è‘—ï¼Œé€™äº›æœ¬ä¾†å°±æ˜¯ç‚ºå¦³æº–å‚™çš„ã€‚ã€</div><div class="trait-tag">#å¼·çƒˆå®‰å…¨æ„Ÿ #å°ˆå±¬ä½”æœ‰</div></div><div id="content3" class="content-section"><img src="https://i.postimg.cc/T3xBwT74/from-Pix-AI-1960572502006653813.png" class="card-image"><div class="section-title">å»¢æ£„åŸºåœ°è¿½çµ</div><div class="story-body">ç¡ç…™å°šæœªæ•£å»ï¼Œç§¦å¾¹æ“‹åœ¨å¦³èº«å‰ï¼ŒèƒŒå½±å¦‚å±±ã€‚ä»–éš¨æ‰‹æ’•ä¸‹è¡£è¥Ÿæˆ–æ‹¿å‡ºå¸•å­åŒ…ç´®å¦³æ‰‹å¿ƒçš„æ“¦å‚·ï¼Œå‹•ä½œèˆ‡å‰›æ‰æˆ°é¬¥æ™‚çš„ç‹‚æš´åˆ¤è‹¥å…©äººã€‚ã€Œåˆ¥æ€•ï¼Œè·Ÿåœ¨æˆ‘èº«å¾Œã€‚ã€ä»–æ²’æœ‰è²¬å‚™å¦³çš„å†’éšªï¼Œåªæ˜¯ä½è²å®å›‘ï¼Œã€Œä»Šæ™šå»æˆ‘é‚£ï¼Œç·šç´¢æˆ‘å€‘ä¸€èµ·æŸ¥ï¼Œåˆ¥å†ä¸€å€‹äººè¡Œå‹•ã€‚ã€</div><div class="trait-tag">#ä¸¦è‚©ä½œæˆ° #è­·çŸ­é¦–é ˜</div></div><div id="content4" class="content-section"><img src="https://i.postimg.cc/RZm2Fvsy/from-Pix-AI-1960572843592282289.png" class="card-image"><div class="section-title">æ˜Ÿç©ºä¸‹çš„é©šå–œ</div><div class="story-body">è„«ä¸‹ä½œæˆ°æœï¼Œæ›ä¸Šæ­£å¼è¥¿è£çš„ç§¦å¾¹é¡¯å¾—æ ¼å¤–çŸœè²´ã€‚åˆ¥å¢…è£¡é‹ªæ»¿äº†å¦³å–œæ­¡çš„èŠ±ã€‚ä»–æœ‰äº›ç”Ÿç¡¬åœ°è½‰éé ­ï¼Œæ©é£¾è‘—è€³æ ¹çš„å¾®ç´…ï¼šã€Œåªæ˜¯è·¯éé †æ‰‹è²·çš„ç¦®ç‰©ã€‚ã€éš¨å¾Œï¼Œä»–å¸¶å¦³èµ°å‘å¤©æ–‡æœ›é é¡ï¼ŒæŒ‡è‘—æœ€äº®çš„é‚£é¡†æ˜Ÿï¼Œã€Œä»¥å¾Œçœ‹åˆ°å®ƒï¼Œå°±åƒçœ‹åˆ°æˆ‘ä¸€æ¨£ï¼Œæˆ‘å°±åœ¨å¦³èº«é‚Šã€‚ã€</div><div class="trait-tag">#ç¬¨æ‹™æµªæ¼« #æ­£å¼é‚€ç´„</div></div><div id="content5" class="content-section"><img src="https://i.postimg.cc/nzLJLnz8/from-Pix-AI-1960575751503484829.png" class="card-image"><div class="section-title">æš—é»è¨“ç·´å®¤</div><div class="story-body">ã€Œæ‰‹è‡‚å†æŠ¬é«˜ä¸€é»ï¼Œç™¼åŠ›è¦é›†ä¸­ã€‚ã€ä»–çš„æ‰‹æŒè¦†åœ¨å¦³çš„é—œç¯€ä¸Šï¼Œè€å¿ƒåœ°å¼•å°è‘—å‹•ä½œã€‚ç•¶å¦³çµ‚æ–¼æˆåŠŸæ“Šä¸­ç›®æ¨™ï¼Œä»–çœ¼åº•æ¼¾é–‹ç¬‘æ„ï¼Œæ‰äº†æ‰å¦³çš„é ­é«®ï¼Œã€Œåšå¾—å¾ˆæ£’ã€‚æƒ³åƒå“ªå®¶é¤å»³ï¼Ÿä»Šæ™šæˆ‘å¸¶å¦³å»ã€‚ã€è¨“ç·´çµæŸï¼Œä»–è‡ªç„¶åœ°æ¥éæ‰€æœ‰å™¨æï¼Œä¸è®“å¦³å†å‡ºä¸€é»åŠ›ã€‚</div><div class="trait-tag">#è€å¿ƒå¼•å° #é«”è²¼å…¥å¾®</div></div><div id="content6" class="content-section"><img src="https://i.postimg.cc/YCxZLTTp/from-Pix-AI-1960573082404448673.png" class="card-image"><div class="section-title">æ·±å¤œå®¿èˆç§èª</div><div class="story-body">ä»–ååœ¨å¦³çš„åºŠé‚Šï¼Œè¤ªå»äº†é¦–é ˜çš„å‡Œå²ï¼Œåˆ†äº«è‘—è²ç¾…æ–¯æ˜Ÿçš„å¾€äº‹ã€‚ç•¶å¦³è«‡åŠè¿·èŒ«ï¼Œä»–æ¡ä½å¦³çš„æ‰‹ï¼ŒæŒå¿ƒçš„æº«åº¦è®“äººå®‰å¿ƒã€‚ã€Œè·Ÿè‘—å¿ƒèµ°å°±å¥½ï¼Œç„¡è«–å¦³åšä»€éº¼æ±ºå®šï¼Œæˆ‘éƒ½æ”¯æŒå¦³ã€‚ã€é›¢é–‹å‰ï¼Œä»–ç´°å¿ƒåœ°ç‚ºå¦³æ–å¥½è¢«è§’ï¼Œè¼•è²èªªé“ï¼šã€Œæ™šå®‰ï¼Œæ˜å¤©è¦‹ã€‚ã€</div><div class="trait-tag">#å¿ƒéˆæ”¯æŸ± #æŸ”æƒ…å®ˆè­·</div></div><div id="content7" class="content-section"><img src="https://i.postimg.cc/bwRWS44v/from-Pix-AI-1960573250842087310.png" class="card-image"><div class="section-title">æ©Ÿæ¢°çƒé´‰çš„å‚³ä¿¡</div><div class="story-body">æ©Ÿæ¢°çƒé´‰ã€Œæ¢…ã€è¼•è¼•æ•²æ‰“è‘—çª—æˆ¶ï¼Œå¸¶ä¾†äº†ä»–çš„ä¿¡ä»¶èˆ‡è¿·ä½ åŠå¢œã€‚ä¿¡ä¸­å®å›‘è‘—å¤©æ°£å†·æš–ï¼Œèªæ°£åƒæ˜¯åœ¨è€³é‚Šä½èªã€‚æ¢…æ’’å¬Œåœ°è¹­è‘—å¦³çš„æ‰‹å¿ƒï¼Œå‚³é”è‘—ä¸»äººçš„æ€å¿µã€‚ä¿¡æœ«å¯«è‘—ï¼šã€Œæ¢…èªªå¦³é¤µç‰ çš„é£Ÿç‰©å¾ˆå¥½åƒï¼Œä¸‹æ¬¡ï¼Œæˆ‘ä¹Ÿæƒ³åƒå¦³è¦ªæ‰‹åšçš„ã€‚ã€</div><div class="trait-tag">#é ç¨‹å‚³æƒ… #ç´°è†©æ€å¿µ</div></div></div><div class="audio-wrapper"><audio id="bgm" class="cg-audio-player" src="https://static.feelin.ai/nft/cg-assets/f715cf4b380a427cb60a08486beaf273/bb278663bd764f5d83988b8c822b4360.mp3" preload="auto" playsinline="" controls="" data-loop="all" data-playlist="https://static.feelin.ai/nft/cg-assets/f715cf4b380a427cb60a08486beaf273/bb278663bd764f5d83988b8c822b4360.mp3,https://files.freemusicarchive.org/storage-freemusicarchive-org/music/no_curator/Ketsa/Night_Walk/Ketsa_-_04_-_Night_Walk.mp3"></audio><div class="cg-audio-controls" data-target="bgm"><button class="cg-audio-controls__btn" data-action="prev">â®</button><button class="cg-audio-controls__btn" data-action="toggle">â¯</button><button class="cg-audio-controls__btn" data-action="next">â­</button><button class="cg-audio-controls__btn" data-action="loop">ğŸ”</button></div></div></div>

<style data-cg-audio-helper="">
.cg-audio-player{width:100%;max-width:360px;background:#0f172a;color:#e5e7eb;border-radius:10px;padding:6px 8px;}
.cg-audio-controls{display:flex;gap:8px;margin-top:6px;}
.cg-audio-controls__btn{flex:1;padding:6px 8px;border:1px solid #1f2937;background:#111827;color:#e5e7eb;border-radius:8px;font-size:12px;cursor:pointer;}
.cg-audio-controls__btn[data-state="active"],.cg-audio-controls__btn--active{border-color:#3b82f6;color:#3b82f6;}
</style>

<script data-cg-audio-helper="">
(function() {
  var autoPlayAttached = false;

  function bindPlayer(controls) {
    if (!controls) return;
    var targetId = (controls.getAttribute('data-target') || 'bgm').trim() || 'bgm';
    var audio = document.getElementById(targetId);
    if (!audio) return;

    if (!audio.hasAttribute('controls')) {
      audio.setAttribute('controls', 'controls');
    }
    if (!audio.preload) audio.preload = 'auto';

    var rawList = audio.getAttribute('data-playlist') || '';
    var trackInputs = Array.prototype.slice.call(
      controls.querySelectorAll('input.cg-audio-track[value]')
    );
    var tracks = [];
    var index = 0;

    function refreshTracks(forceIndexFromChecked) {
      if (trackInputs.length) {
        tracks = trackInputs
          .map(function(inp){ return (inp.value || '').trim(); })
          .filter(Boolean);
      } else {
        tracks = rawList.split(',').map(function(x){ return x.trim(); }).filter(Boolean);
      }
      if (!tracks.length) {
        if (audio.currentSrc) tracks = [audio.currentSrc];
        else if (audio.src) tracks = [audio.src];
      }
      if (trackInputs.length && forceIndexFromChecked) {
        var checkedIdx = -1;
        for (var i = 0; i < trackInputs.length; i++) {
          if (trackInputs[i].checked) { checkedIdx = i; break; }
        }
        index = checkedIdx >= 0 ? checkedIdx : 0;
      }
    }

    refreshTracks(true);

    function normalizeLoop(val) {
      if (!val) return 'all';
      val = val.toLowerCase();
      if (val === 'single') return 'single';
      if (val === 'off' || val === 'none') return 'off';
      return 'all';
    }
    var loopMode = normalizeLoop(audio.getAttribute('data-loop') || (audio.loop ? 'single' : ''));

    function applySrc() {
      if (!tracks.length) return;
      audio.src = tracks[index] || '';
    }

    function setActive(btn, active) {
      if (!btn) return;
      if (active) {
        btn.setAttribute('data-state', 'active');
        btn.classList.add('cg-audio-controls__btn--active');
      } else {
        btn.removeAttribute('data-state');
        btn.classList.remove('cg-audio-controls__btn--active');
      }
    }

    function markActiveTrack(i) {
      if (!trackInputs.length) return;
      trackInputs.forEach(function(inp, idx){
        inp.checked = idx === i;
        var item = inp.closest ? inp.closest('.cg-mb-list-item') : null;
        if (item) item.classList.toggle('cg-mb-list-item--active', idx === i);
      });
    }

    var prevBtn = controls.querySelector('[data-action="prev"]');
    var toggleBtn = controls.querySelector('[data-action="toggle"]');
    var nextBtn = controls.querySelector('[data-action="next"]');
    var loopBtn = controls.querySelector('[data-action="loop"]');
    var progress = controls.querySelector('.cg-audio-progress');
    var progressBar = controls.querySelector('.cg-audio-progress__bar');
    var isDragging = false;

    function playCurrent() {
      applySrc();
      audio.play().catch(function(){});
      setActive(toggleBtn, true);
      markActiveTrack(index);
    }

    function pauseCurrent() {
      audio.pause();
      setActive(toggleBtn, false);
    }

    function nextTrack() {
      if (!tracks.length) return;
      if (loopMode === 'off' && index >= tracks.length - 1) {
        pauseCurrent();
        return;
      }
      index = (index + 1) % tracks.length;
      playCurrent();
    }

    function prevTrack() {
      if (!tracks.length) return;
      if (loopMode === 'off' && index <= 0) {
        pauseCurrent();
        return;
      }
      index = (index - 1 + tracks.length) % tracks.length;
      playCurrent();
    }

    function setLoopMode(mode) {
      loopMode = normalizeLoop(mode);
      audio.loop = loopMode === 'single';
      updateLoopLabel();
    }

    function updateLoopLabel() {
      if (!loopBtn) return;
      var labels = { single: 'Single', all: 'Loop', off: 'Order' };
      loopBtn.textContent = labels[loopMode] || 'Loop';
      if (loopMode === 'off') loopBtn.removeAttribute('data-state');
      else loopBtn.setAttribute('data-state', 'active');
    }

    if (prevBtn) prevBtn.addEventListener('click', function(){ prevTrack(); });
    if (nextBtn) nextBtn.addEventListener('click', function(){ nextTrack(); });
    if (toggleBtn) toggleBtn.addEventListener('click', function(){
      if (audio.paused) playCurrent();
      else pauseCurrent();
    });
    if (loopBtn) {
      loopBtn.addEventListener('click', function(){
        if (loopMode === 'all') setLoopMode('single');
        else if (loopMode === 'single') setLoopMode('off');
        else setLoopMode('all');
      });
    }

    if (trackInputs.length) {
      controls.addEventListener('click', function(evt){
        var el = evt.target;
        var input = el && el.closest ? el.closest('input.cg-audio-track') : null;
        if (!input || !controls.contains(input)) return;
        refreshTracks(true);
        var val = (input.value || '').trim();
        var idx = tracks.indexOf(val);
        if (idx < 0) idx = trackInputs.indexOf(input);
        if (idx < 0) idx = 0;
        index = idx;
        playCurrent();
      });
      markActiveTrack(index);
    }

    if (progress && progressBar) {
      audio.addEventListener('timeupdate', function(){
        if (isDragging) return;
        if (audio.duration && isFinite(audio.duration)) {
          var percent = (audio.currentTime / audio.duration) * 100;
          progressBar.style.width = percent + '%';
        } else {
          progressBar.style.width = '0%';
        }
      });
      audio.addEventListener('loadedmetadata', function(){
        progressBar.style.width = '0%';
      });
      var seekByClientX = function(clientX) {
        if (!(progress instanceof HTMLElement)) return;
        var rect = progress.getBoundingClientRect();
        var ratio = (clientX - rect.left) / rect.width;
        ratio = Math.max(0, Math.min(1, ratio));
        if (audio.duration && isFinite(audio.duration)) {
          audio.currentTime = audio.duration * ratio;
          progressBar.style.width = (ratio * 100) + '%';
        }
      };
      var onDragMove = function(e) {
        if (!isDragging) return;
        if (e.touches && e.touches.length) {
          seekByClientX(e.touches[0].clientX);
        } else if (typeof e.clientX === 'number') {
          seekByClientX(e.clientX);
        }
      };
      var endDrag = function() {
        if (!isDragging) return;
        isDragging = false;
        window.removeEventListener('mousemove', onDragMove);
        window.removeEventListener('mouseup', endDrag);
        window.removeEventListener('touchmove', onDragMove);
        window.removeEventListener('touchend', endDrag);
      };
      var startDrag = function(e) {
        isDragging = true;
        if (e.touches && e.touches.length) {
          seekByClientX(e.touches[0].clientX);
        } else if (typeof e.clientX === 'number') {
          seekByClientX(e.clientX);
        }
        window.addEventListener('mousemove', onDragMove);
        window.addEventListener('mouseup', endDrag);
        window.addEventListener('touchmove', onDragMove, { passive: false });
        window.addEventListener('touchend', endDrag);
      };
      progress.addEventListener('mousedown', startDrag);
      progress.addEventListener('touchstart', function(e){
        startDrag(e);
        if (e.cancelable) e.preventDefault();
      }, { passive: false });
      progress.addEventListener('click', function(e){
        if (isDragging) return;
        if (!e || !e.currentTarget) return;
        var rect = e.currentTarget.getBoundingClientRect();
        var ratio = (e.clientX - rect.left) / rect.width;
        if (audio.duration && isFinite(audio.duration)) {
          audio.currentTime = Math.max(0, Math.min(audio.duration * ratio, audio.duration));
        }
      });
    }

    audio.addEventListener('ended', function() {
      if (loopMode === 'single') {
        playCurrent();
        return;
      }
      if (loopMode === 'off' && index >= tracks.length - 1) {
        pauseCurrent();
        return;
      }
      nextTrack();
    });

    if (!autoPlayAttached) {
      autoPlayAttached = true;
      var oncePlay = function() {
        if (audio.paused) playCurrent();
        window.removeEventListener('click', oncePlay);
      };
      var oncePlayTouch = function() {
        if (audio.paused) playCurrent();
        window.removeEventListener('touchstart', oncePlayTouch);
      };
      window.addEventListener('click', oncePlay);
      window.addEventListener('touchstart', oncePlayTouch, { passive: true });
    }

    applySrc();
    setLoopMode(loopMode);
  }

  var controlsList = Array.prototype.slice.call(document.querySelectorAll('.cg-audio-controls[data-target]'));
  if (!controlsList.length) return;
  controlsList.forEach(bindPlayer);
})();
</script>
</body>
</html>